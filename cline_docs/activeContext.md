# Active Context

## 必ず守ること(編集禁止)
現在のタスクに書かれた内容は必ず1つずつ「Plan/Act」を経てユーザーに確認しながら実装すること。Planで実装計画を立てた後、Actで実装に入った場合「現在のタスク」に列挙されたタスクを一度に全部こなしてはいけません。必ず1つずつPlan→Actを行い、1つ完了したらユーザーに確認し、Planで再び実装計画から行ってください。

## Current Task: PlaywrightコマンドからテストケースJSONへの変換

`nextTask.md` の指示に基づき、Playwrightで記録されたコマンドをテストケースJSON形式に変換します。
この大きな目標の中で、まずセレクタ仕様の拡張を行い、その後コマンド変換を行います。
このタスクは全て完了しました。

## 課題と対応策

Playwrightコマンドの中には、現在のテストケースJSONのセレクタ仕様では直接変換できない複雑なものが存在します。

**課題: チェインされたセレクタやインデックス指定 (`nth()`)**
- **コマンド例:** `await page.getByRole('row', { name: '...' }).getByRole('button').nth(1).click();`
- **問題点:** 現在のセレクタ仕様は、単一の要素指定を前提としており、複数のセレクタを連結したり、結果セットから特定のインデックスの要素を選択したりする機能を持ちません。

**対応方針: セレクタ仕様の拡張**
- テストケースJSONのセレクタ仕様を拡張し、チェインされたセレクタやインデックス指定などの高度な機能をサポートします。
- これにより、Playwrightの表現力をより忠実にテストケースJSONに反映でき、将来的に同様のケースに柔軟に対応できるようになります。
- 関連ドキュメントの更新、Pythonコード（`actions/mixins.py`、関連アクションクラス）の修正、およびユニットテストの追加・更新が必要となります。

## Recent Changes

- [x] アクション仕様書の作成タスクが完了しました。
- [x] 新しいタスク「PlaywrightコマンドからテストケースJSONへの変換」に着手しました。
- [x] 複雑なセレクタの対応について、正規表現フィルタリングは不要とし、チェインセレクタとインデックス指定については「セレクタ仕様の拡張」で対応する方針をユーザーと合意しました。
- [x] セレクタ仕様の拡張を実装し、以下の機能を追加しました：
  - [x] チェインされたセレクタのサポート（`chain`配列を使用）
  - [x] インデックス指定のサポート（`index`パラメータを使用）
  - [x] 複数要素が見つかった場合のデフォルト動作（最初の要素を選択）
  - [x] 無効なインデックス値のバリデーション
- [x] 新しいセレクタ仕様に対するユニットテストを追加し、すべてのテストがパスすることを確認しました。

## Next Steps

1. [x] **セレクタ仕様の拡張** を行う。
    *   [x] 影響範囲の調査（関連する `action_design_*.md` ドキュメント、`actions/mixins.py`、各アクションクラス、テストコード）。
    *   [x] 新しいセレクタ仕様（JSON構造、キー名など）の具体的な提案を作成する。
    *   [x] 提案された仕様に基づいて、関連ドキュメントを更新する。
    *   [x] 提案された仕様に基づいて、Pythonコード（`actions/mixins.py`、関連アクションクラス）を実装・修正する。
    *   [x] 新しいセレクタ仕様に対応するユニットテストを作成・更新する。
---
