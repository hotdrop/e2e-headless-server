# Product Context

## プロジェクトの目的
このプロジェクトは、E2E（エンドツーエンド）テストを支援するためのサーバーアプリケーションを開発することを目的としています。

## 解決する問題
WebアプリケーションのE2Eテストを手動または複雑な設定で行う手間を削減します。特に、テストケースをJSON形式で定義し、APIリクエストを通じて簡単にテストを実行できる環境を提供することで、開発プロセスを効率化します。

## 主要技術スタック
- プログラミング言語: Python
- Webフレームワーク: Flask
- E2Eテストライブラリ: Playwright (Chromiumブラウザを使用)
- コンテナ化: Docker
- テストフレームワーク: pytest

# ディレクトリ構成
project_root/
├── app.py
├── config.py
├── actions/     # テストケースJSONのacionを実装する場合はここ
│　　　├── base.py
│　　　├── click.py
│　　　└── ...
├── tests/       # テストケースJSONのactionを実装した場合は必ずユニットテストも実装する
│　　　├── test_input_action.py
│　　　├── test_click_action.py
│　　　└── ...
├── services/    # 利用サービスの実装はここ
│　　　├── firestore_client.py
│　　　└── storage.py
├── cline_docs/  # MemoryBankで使用するdocs
│　　　└── ...
├── design_docs/ # アクションや利用サービスの実装仕様。アクションの実装を把握したい場合はここのドキュメントを参照のこと
│　　　├── action_design_xxxx.md
│　　　└── ...
├── requirements.txt
└── dockerfile

## アーキテクチャ概要
- FlaskベースのAPIサーバーとして構築されています。
- 単一のエンドポイント`/run_tests`(POST)を持ちます。
- `/run_tests`API仕様
  - APIリクエストのパラメータとしてJSONオブジェクトでテストケースを受け取ります
  - APIキー認証を採用します。過度に複雑なセキュリティは避けつつ、完全な公開状態を防ぐためです。API Keyは環境変数で設定します。
  - 実行結果をJSON形式でレスポンスします。
- Playwrightライブラリを使用して、受け取ったテストケースに基づきブラウザ操作を実行します。
- Dockerコンテナとして実行されることを前提としています。なお、`playwright install --with-deps chromium` により依存関係を管理します。

## 設計パターン
- Actionクラス: 各テスト操作（クリック、入力など）は `actions/` ディレクトリ内に個別のPythonファイルとして実装されます。
- 継承: 全てのアクションクラスは `actions/base.py` のベースクラスを継承する必要があります。
- Factoryパターン: `actions/factory.py` が存在することから、テストケースJSONの `action` 要素の値に基づいて適切なアクションクラスのインスタンスを生成するFactoryパターンが使用されていると考えられます。
- テスト駆動開発: `tests/` ディレクトリが存在し、アクションごとにテストファイルが用意されていることから、テスト駆動開発またはそれに準じた開発スタイルが推奨されています。各アクションの実装と同時にテストも実装することが求められます。

## 期待される動作
- 単一のAPIエンドポイント (`/run_tests`) を提供します。
- APIリクエストでテスト対象のWebサイトURLとテストケース（JSON形式）を受け取ります。
- 受け取ったテストケースに基づき、Playwrightライブラリを使用してヘッドレスブラウザで指定されたアクション（クリック、入力、待機、アサーションなど）を実行します。
- テストの実行結果（成功/失敗、ログ、失敗理由など）をAPIレスポンスとして返します。
- ローカル環境（Docker）およびリモート環境（Google Cloud Run）での実行をサポートします。
- APIキーによる簡単な認証メカニズムを備えます。
