# System Patterns

## アーキテクチャ概要
- FlaskベースのAPIサーバーとして構築されています。
- 単一のエンドポイント `/run_tests` (POST) を持ちます。
- リクエストボディでテスト対象URLとJSON形式のテストケースを受け取ります。
- Playwrightライブラリを使用して、受け取ったテストケースに基づきブラウザ操作を実行します。
- 実行結果をJSON形式でレスポンスします。
- Dockerコンテナとして実行されることを前提としています。

## 主要な技術決定
- E2Eテストライブラリ: SeleniumではなくPlaywrightを採用。WebDriver不要、非同期処理への対応、Microsoftによる開発が理由。
- Webフレームワーク: FastAPIではなくFlaskを採用。シンプルな構成で迅速に開発を開始するため。将来的な拡張性からFastAPIも検討されました。
- テストケースの受け渡し: APIリクエストのパラメータとしてJSONオブジェクトで渡す方式を採用。開発速度と疎結合性を両立するため。将来的にはファイルパスを指定する方式も検討可能。
- API認証: APIキー認証を採用。過度に複雑なセキュリティは避けつつ、完全な公開状態を防ぐため。ローカルでは環境変数、Cloud RunではSecret Manager（未実装）での管理を想定。
- コンテナ化: Dockerを採用。`playwright install --with-deps chromium` により依存関係を管理。

## 設計パターン
- アクションクラス: 各テスト操作（クリック、入力など）は `actions/` ディレクトリ内に個別のPythonファイルとして実装されます。
- 継承: 全てのアクションクラスは `actions/base.py` のベースクラスを継承する必要があります。
- Factoryパターン: `actions/factory.py` が存在することから、テストケースJSONの `action` 要素の値に基づいて適切なアクションクラスのインスタンスを生成するFactoryパターンが使用されていると考えられます。
- テスト駆動開発: `tests/` ディレクトリが存在し、アクションごとにテストファイルが用意されていることから、テスト駆動開発またはそれに準じた開発スタイルが推奨されています。各アクションの実装と同時にテストも実装することが求められます。
