# Screenshot アクション

## 概要
表示されているページの現在の状態のスクリーンショットを取得し、指定されたストレージに保存します。ファイル名は実行時のタイムスタンプに基づいて自動的に生成されます。

## 詳細
- このアクションは、ページ全体のスクリーンショットをPNG形式で取得します。
- スクリーンショットのファイル名は、`YYYYMMDD_HHMMSS.png`の形式で、実行時のタイムスタンプに基づいて自動生成されます。
- 取得されたスクリーンショットは、まず設定された一時ディレクトリに保存され、その後`StorageHandler`サービスを介して最終的なストレージ場所に保存されます。保存先のディレクトリについては以下を参照してください。
- アクション実行後、レスポンスには保存されたスクリーンショットのパスは含まず"executed"とだけ返します
  - 実装当初は保存先のパスを返していました。しかし`Cloud Run`上で動作させる場合、URLを知っていれば誰でもAPIを実行できてしまいます。APIKeyが漏れなければ認証処理が通りませんが、万が一そこを突破された場合、極力情報を与えないようパスは何も返さないことにしました。なお、パスを返してもバケットのアクセス権を絞っているので問題はありませんが無用なリスクは避けるべきと判断しました。
- このアクションは`site_id`を利用してスクリーンショットの保存場所を整理しますが、`site_id`はテストステップのJSONではなく、実行環境から提供される前提です。

## 保存先のディレクトリまたはストレージ
- ENVが"dev"の場合
  - Dockerコンテナ内の`/output/[siteId]/[日付]/[ファイル名]`に画像を保存します。
- ENVが"dev"でない場合
  - `Cloud Storage`に画像を保存します。
  - 保存先バケット名は環境変数`CLOUD_STORAGE_BUCKET`から取得します。この環境変数が設定されていない場合のデフォルト値は"e2e-test-screenshots"です。(config.pyを参照のこと)
  - バケット内のパス（オブジェクト名）は`CLOUD_STORAGE_BUCKET/[siteId]/[日付]/[ファイル名]`になります。

## パラメータ
このアクションで使用できるパラメータは以下の通りです。

| Key      | 型     | 必/任 | 説明              |
|----------|--------|------|------------------|
| `action` | string | 必須  | "screenshot" |
| `text`   | string | 任意  | スクリーンショットに関するユーザー向けの自由記述メモ。このテキストはアクションの動作には影響しません。 |

## セレクタ
このアクションは、特定の要素を指定するためのセレクタをサポートしていません。ページ全体のスクリーンショットが取得されます。

## JSONサンプル
```json
{
  "action": "screenshot",
  "text": "任意のメモ"
}
```
